# Copilot Instructions for Norad - ID3v2 Frame Analyzer

## Project Overview
Norad is a command-line ID3v2 frame analyzer tool written in C++20. It parses and analyzes ID3v2 metadata frames in audio files, providing both processed and raw frame data output.

## Key Technologies & Standards
- **Language**: C++20 (requires modern C++ features)
- **Build System**: CMake 3.23+
- **Command Line Interface**: CLI11 library (v2.4.1)
- **Target Standard**: ID3v2 metadata specification
- **Platforms**: Windows, macOS (Darwin), Ubuntu Linux
- **License**: MIT License

## Architecture & Core Components

### Main Components
- `main.cpp` - Entry point with CLI argument parsing
- `FrameController` - Core frame parsing and analysis logic
- `ID3V2` - ID3v2 specification implementation
- `BinaryStream` - Binary data handling utilities
- `Frame` hierarchy - Various frame type implementations
- `FileUtilities` - File I/O operations

### Frame Types Supported
- `TextInformationFrame` - Text-based metadata
- `URLLinkFrame` - URL link frames
- `AttachedPictureFrame` - Embedded images
- `ChapterFrame` - Chapter markers
- `TableOfContentsFrame` - TOC structures
- `CommentsFrame` - Comment data

## Coding Standards & Patterns

### Namespace Structure
All code should be in the `ultralove::tools::norad` namespace hierarchy.

### Header Guards
Use traditional header guards: `#ifndef __FILENAME_H_INCL__`

### Copyright Header
All files must include the MIT license header with Ultralove Contributors attribution.

### Code Style
- Use consistent indentation (spaces preferred)
- Follow modern C++20 best practices
- Use RAII principles for resource management
- Prefer smart pointers over raw pointers
- Use const-correctness throughout

### Error Handling
- Use exceptions for error conditions
- Provide clear error messages to users
- Handle file I/O errors gracefully

## Key Design Patterns

### Factory Pattern
`FrameFactory` creates appropriate frame objects based on frame IDs.

### Stream Processing
Binary data is processed through `BinaryStream` objects for efficient parsing.

### Polymorphic Frame Handling
Base `Frame` class with derived classes for specific frame types using virtual methods.

## Build & Dependencies

### External Dependencies
- CLI11 (automatically fetched via FetchContent)
- Standard C++20 library

### Platform-Specific Considerations
- macOS: Universal binary support (x86_64 + arm64) for newer compilers
- Cross-platform file handling with proper path separators
- Platform detection in CMake for conditional compilation

## Development Guidelines

### When Adding New Features
1. Consider ID3v2 specification compliance
2. Maintain backward compatibility
3. Add appropriate error handling
4. Update CLI help text if needed
5. Test on all supported platforms

### When Adding New Frame Types
1. Inherit from base `Frame` class
2. Implement required virtual methods
3. Register in `FrameFactory`
4. Add proper parsing logic
5. Include unit tests

### Memory Management
- Use RAII for all resources
- Prefer stack allocation when possible
- Use smart pointers for dynamic allocation
- Avoid memory leaks in binary stream processing

## CLI Interface Patterns
- Use descriptive flag names
- Provide both short and long options where appropriate
- Include helpful error messages
- Support batch processing of multiple files

## Testing & Validation
- Test with various ID3v2 versions
- Validate frame parsing accuracy
- Test error conditions and edge cases
- Verify cross-platform compatibility

## Performance Considerations
- Efficient binary data parsing
- Minimize memory allocations
- Stream-based processing for large files
- Avoid unnecessary data copying

## Common Tasks & Patterns

### Adding a New CLI Option
1. Add flag to CLI::App in main.cpp
2. Add corresponding global variable
3. Implement logic in main processing loop
4. Update help documentation

### Adding New Frame Parser
1. Create new frame class inheriting from Frame
2. Implement Parse() method
3. Add to FrameFactory
4. Add frame ID constants to appropriate headers

### Binary Data Parsing
- Use BinaryStream class for all binary operations
- Handle endianness correctly
- Validate data boundaries
- Use size_t for all size calculations

## Security Considerations
- Validate all input data sizes
- Check for buffer overflows in binary parsing
- Sanitize file paths
- Handle malformed ID3v2 data gracefully

---

*This file should be updated as the project evolves. Keep instructions current with actual implementation.*
